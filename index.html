<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Food Image Search + Nearby Restaurants</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0d1117;--card:#161b22;--muted:#8b949e;--accent:#58a6ff;--accent2:#1f6feb;--text:#f0f6fc;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;transition:all 0.3s ease;}
    body{margin:0;background:var(--bg);color:var(--text);display:flex;align-items:flex-start;justify-content:center;padding:40px;overflow-x:hidden;}
    .container{width:100%;max-width:1100px;animation:fadeIn 1s ease forwards;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);} }
    header{display:flex;align-items:center;gap:16px;margin-bottom:20px;}
    header img{height:44px;animation:float 3s ease-in-out infinite;}
    @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);} }
    h1{font-size:22px;margin:0;color:var(--text);}
    p.lead{margin:0;color:var(--muted);}

    .card{background:var(--card);border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,0.3);}
    .grid{display:grid;grid-template-columns:380px 1fr;gap:18px;margin-top:18px;}

    .uploader{display:flex;flex-direction:column;gap:12px;}
    .preview{height:260px;border-radius:12px;background:linear-gradient(180deg,#1f2937,#111827);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}
    .preview img{max-width:100%;max-height:100%;object-fit:contain;border-radius:12px;}
    .controls{display:flex;gap:8px;}
    input[type=file]{display:none;}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600;box-shadow:0 0 10px rgba(88,166,255,0.3);}
    .btn:hover{background:var(--accent2);}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(88,166,255,0.5);}
    .btn.ghost:hover{background:rgba(88,166,255,0.1);}

    .meta{margin-top:8px;color:var(--muted);font-size:14px;}
    .results-section{display:flex;flex-direction:column;gap:12px;}

    #map{height:400px;border-radius:12px;}
    .list{max-height:400px;overflow:auto;scrollbar-width:thin;}
    .place{padding:10px;border-radius:8px;background:#1c2128;border:1px solid #30363d;margin-bottom:8px;transition:background 0.3s;}
    .place:hover{background:#21262d;}
    .place h3{margin:0;font-size:15px;color:var(--text);}
    .place p{margin:4px 0 0;color:var(--muted);font-size:13px;}

    .food-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:30px;}
    .food-gallery img{width:100%;height:100px;object-fit:cover;border-radius:10px;transition:transform 0.4s ease, box-shadow 0.4s ease;}
    .food-gallery img:hover{transform:scale(1.05);box-shadow:0 6px 20px rgba(88,166,255,0.4);}

    footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center;}

    @media (max-width:900px){.grid{grid-template-columns:1fr;}.preview{height:200px;}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='88' height='20'><rect width='88' height='20' rx='6' fill='%2358a6ff'/><text x='12' y='14' font-family='Arial' font-size='11' fill='white'>FoodFinder</text></svg>" alt="logo">
      <div>
        <h1>Food Image Search — Find Nearby Restaurants</h1>
        <p class="lead">Upload a photo of a dish or ingredient and explore nearby places serving it.</p>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <div>
          <div class="uploader">
            <div class="preview" id="preview"> <span id="previewText">No image selected</span> </div>

            <div class="controls">
              <label class="btn" for="imageInput">Upload Image</label>
              <input type="file" id="imageInput" accept="image/*">
              <button class="btn ghost" id="detectBtn">Detect & Search</button>
            </div>
            <div class="meta">Detected labels: <span id="labels">—</span></div>
            <div class="meta">Location: <span id="loc">not set</span></div>
            <div style="margin-top:8px;color:var(--muted);font-size:13px">Tip: Allow location access to view nearby restaurant matches.</div>
          </div>
        </div>

        <div>
          <div class="results-section">
            <div id="map" class="card"></div>
            <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
              <h2 style="margin:0;font-size:16px;color:var(--text)">Nearby Matches</h2>
              <div style="font-size:13px;color:var(--muted)" id="detectedKeyword">Keyword: —</div>
            </div>
            <div class="list" id="placesList"></div>
          </div>
        </div>
      </div>

      <div class="food-gallery" id="foodGallery">
        <img src="https://source.unsplash.com/featured/?pizza" alt="pizza">
        <img src="https://source.unsplash.com/featured/?sushi" alt="sushi">
        <img src="https://source.unsplash.com/featured/?burger" alt="burger">
        <img src="https://source.unsplash.com/featured/?tacos" alt="tacos">
        <img src="https://source.unsplash.com/featured/?pasta" alt="pasta">
        <img src="https://source.unsplash.com/featured/?salad" alt="salad">
        <img src="https://source.unsplash.com/featured/?curry" alt="curry">
        <img src="https://source.unsplash.com/featured/?dessert" alt="dessert">
      </div>

      <footer>
    </div>
  </div>

  <script>
    const GOOGLE_API_KEY = 'AIzaSyA1QlFRdXdekbjWhOq2fvFbOPTtfTliQnc';
    let selectedImageBase64 = null;
    let map, placesService, userLocation;

    const preview = document.getElementById('preview');
    const previewText = document.getElementById('previewText');
    const imageInput = document.getElementById('imageInput');
    const detectBtn = document.getElementById('detectBtn');
    const labelsEl = document.getElementById('labels');
    const locEl = document.getElementById('loc');
    const placesList = document.getElementById('placesList');
    const detectedKeywordEl = document.getElementById('detectedKeyword');

    imageInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        preview.innerHTML = '';
        const img = document.createElement('img');
        img.src = reader.result;
        preview.appendChild(img);
        selectedImageBase64 = reader.result.split(',')[1];
      };
      reader.readAsDataURL(file);
    });

    detectBtn.addEventListener('click', () => {
      if (!selectedImageBase64) return alert('Please upload an image first.');
      detectLabels(selectedImageBase64);
    });

    async function detectLabels(base64Image) {
      labelsEl.textContent = 'Detecting...';
      try {
        const body = {
          requests: [{ image: {content: base64Image}, features: [{type:'LABEL_DETECTION',maxResults:6},{type:'WEB_DETECTION',maxResults:4}] }]
        };
        const resp = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${GOOGLE_API_KEY}`, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        const data = await resp.json();
        const labels = (data.responses?.[0]?.labelAnnotations || []).map(l=>l.description);
        const web = (data.responses?.[0]?.webDetection?.webEntities || []).map(w=>w.description).filter(Boolean);
        const topCandidates = [...labels, ...web].filter(Boolean);
        labelsEl.textContent = topCandidates.join(', ') || '—';
        const keyword = topCandidates[0] || null;
        detectedKeywordEl.textContent = keyword ? `Keyword: ${keyword}` : 'Keyword: —';
        await getLocationAndSearch(keyword);
      } catch (err) {
        console.error(err);
        labelsEl.textContent = 'Error detecting labels';
      }
    }

    async function getLocationAndSearch(keyword) {
      placesList.innerHTML = '';
      if (!navigator.geolocation) {
        locEl.textContent = 'Geolocation not supported';
        return;
      }
      locEl.textContent = 'Requesting...';
      navigator.geolocation.getCurrentPosition(async (pos) => {
        userLocation = {lat: pos.coords.latitude, lng: pos.coords.longitude};
        locEl.textContent = `${userLocation.lat.toFixed(5)}, ${userLocation.lng.toFixed(5)}`;
        if (!map) initMap();
        map.setCenter(userLocation);
        const request = {location:userLocation,radius:5000,type:'restaurant',keyword:keyword||''};
        placesService.nearbySearch(request, handlePlacesResults);
      }, (err) => {console.error(err);locEl.textContent='Location denied';}, {timeout:10000});
    }

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {center:{lat:51.5074,lng:-0.1278},zoom:13,styles:[{elementType:'geometry',stylers:[{color:'#0e1626'}]},{elementType:'labels.text.stroke',stylers:[{color:'#242f3e'}]},{elementType:'labels.text.fill',stylers:[{color:'#746855'}]},{featureType:'poi',elementType:'labels.text.fill',stylers:[{color:'#d59563'}]}]});
      placesService = new google.maps.places.PlacesService(map);
    }

    function handlePlacesResults(results, status) {
      placesList.innerHTML = '';
      if (status !== google.maps.places.PlacesServiceStatus.OK || !results?.length) {
        placesList.innerHTML = '<div style="color:var(--muted)">No nearby places found.</div>';
        return;
      }
      results.slice(0,10).forEach((place) => {
        const marker = new google.maps.Marker({map, position: place.geometry.location, animation: google.maps.Animation.DROP});
        const div = document.createElement('div');
        div.className = 'place';
        div.innerHTML = `<h3>${place.name}</h3><p>${place.vicinity || ''} • Rating: ${place.rating || '—'}</p>`;
        div.addEventListener('click', () => map.panTo(place.geometry.location));
        placesList.appendChild(div);
      });
    }

    function loadMapsScript() {
      const s = document.createElement('script');
      s.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_API_KEY}&libraries=places&callback=onMapsLoaded`;
      s.async = true; s.defer = true;
      document.head.appendChild(s);
    }
    function onMapsLoaded() { initMap(); }
    window.onMapsLoaded = onMapsLoaded;
    loadMapsScript();
  </script>
</body>
</html>
